<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Basic Meta -->
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Caffeine Half-Life Calculator - Track Your Coffee Metabolism | Docket One</title>
	<meta name="description" content="Calculate how long caffeine stays in your system. Optimize your coffee intake for better sleep and productivity with our scientific caffeine metabolism calculator.">
	<meta name="keywords" content="caffeine calculator, coffee half-life, caffeine metabolism, sleep optimization, caffeine duration, coffee calculator, caffeine clearance, caffeine tracker">
	<meta name="author" content="Docket One">

	<!-- Cache Control -->
	<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
	<meta http-equiv="Pragma" content="no-cache">
	<meta http-equiv="Expires" content="0">

	<!-- Canonical URL -->
	<link rel="canonical" href="https://docket.one/pages/BigKidMath/Caffeine%20Half-Life%20Calculator.html" />

	<!-- Open Graph / Facebook -->
	<meta property="og:type" content="website">
	<meta property="og:url" content="https://docket.one/pages/BigKidMath/Caffeine%20Half-Life%20Calculator.html">
	<meta property="og:title" content="Caffeine Half-Life Calculator - Track Your Coffee Metabolism | Docket One">
	<meta property="og:description" content="Calculate how long caffeine stays in your system. Optimize your coffee intake for better sleep and productivity with our scientific caffeine metabolism calculator.">
	<meta property="og:image" content="https://docket.one/images/caffeine-calculator-preview.jpg">
	<meta property="og:image:width" content="1200">
	<meta property="og:image:height" content="630">
	<meta property="og:site_name" content="Docket One">

	<!-- Twitter -->
	<meta property="twitter:card" content="summary_large_image">
	<meta property="twitter:url" content="https://docket.one/pages/BigKidMath/Caffeine%20Half-Life%20Calculator.html">
	<meta property="twitter:title" content="Caffeine Half-Life Calculator - Track Your Coffee Metabolism | Docket One">
	<meta property="twitter:description" content="Calculate how long caffeine stays in your system. Optimize your coffee intake for better sleep and productivity with our scientific caffeine metabolism calculator.">
	<meta property="twitter:image" content="https://docket.one/images/caffeine-calculator-preview.jpg">
	<meta property="twitter:site" content="@DocketOne">

	<!-- Versioned Assets -->
	<link rel="stylesheet" href="../../common/global-calculator.css?v=20250610">
	<link rel="stylesheet" href="../../styles/caffeine-calculator.css?v=20250610">
	<link rel="stylesheet" href="../../common/navbar-enhanced.css">
    <link rel="stylesheet" href="../../common/santa-improvements.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

	<!-- Preload Resources -->
	<link rel="preload" href="../../scripts/caffeine-calculator.js" as="script">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>


	<!-- Favicon -->
	<link rel="icon" href="../../favicon.ico" type="image/x-icon">

	<!-- Theme Color -->
	<meta name="theme-color" content="#6F4E37"> <!-- Coffee brown color -->

    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Caffeine Half-Life Calculator",
        "description": "Track your caffeine metabolism with scientific accuracy. Calculate remaining caffeine levels, get personalized sleep recommendations, and understand your body's caffeine processing.",
        "url": "https://docket.one/pages/BigKidMath/Caffeine Half-Life Calculator.html",
        "applicationCategory": "CalculatorApplication",
        "operatingSystem": "Any",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "featureList": [
            "Real-time caffeine level tracking",
            "Personalized sleep recommendations",
            "Scientific accuracy based on research",
            "Multiple beverage support",
            "Interactive visualization"
        ],
        "author": {
            "@type": "Organization",
            "name": "Docket One",
            "url": "https://docket.one"
        },
        "breadcrumb": {
            "@type": "BreadcrumbList",
            "itemListElement": [
                {
                    "@type": "ListItem",
                    "position": 1,
                    "name": "Home",
                    "item": "https://docket.one/"
                },
                {
                    "@type": "ListItem",
                    "position": 2,
                    "name": "Big Kid Math",
                    "item": "https://docket.one/pages/BigKidMath/"
                },
                {
                    "@type": "ListItem",
                    "position": 3,
                    "name": "Caffeine Half-Life Calculator",
                    "item": "https://docket.one/pages/BigKidMath/Caffeine Half-Life Calculator.html"
                }
            ]
        }
    }
    </script>

    <!-- Include our SEO components -->
    <script src="../../common/structured-data.js"></script>
    <script src="../../common/breadcrumb.js"></script>
    <script src="../../common/related-calculators.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="../../common/themes/dark-theme.css">
    <link rel="stylesheet" href="../../common/footer/premium-footer.css">
    <script src="../../common/footer/premium-footer.js"></script>
    <script src="../../common/add-breadcrumbs.js"></script>
    <script src="../../common/add-keyboard-accessibility.js"></script></head>

<body x-data="{ showModal: false }">
    <!-- Enhanced Navigation Bar -->
    <nav class="main-nav">
        <div class="nav-container">
            <div class="nav-logo">
                <a href="../../index.html">🧮 Docket One</a>
            </div>
            <div class="nav-search">
                <input type="text" id="calc-search" placeholder="Search calculators..." class="search-input"
                    aria-label="Search calculators">
                <div id="search-results" class="search-results"></div>
            </div>
            <ul class="nav-links">
                <li><a href="../BigKidMath/index.html" class="category-link">Big Kid Math</a></li>
                <li><a href="../CipherLab/index.html" class="category-link">Cipher Lab</a></li>
                <li><a href="../GeekGalaxy/index.html" class="category-link">Geek Galaxy</a></li>
                <li><a href="../LifeHacks/index.html" class="category-link">Life Hacks</a></li>
                <li><a href="../Math_Magik/index.html" class="category-link">Math Magik</a></li>
                <li><a href="../Otaku_Ops/index.html" class="category-link">Otaku Ops</a></li>
                <li><a href="../../index.html" class="home-link">🏠 Home</a></li>
            </ul>
            <button class="mobile-menu-btn" aria-label="Toggle menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>

    <!-- Premium Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <div class="hero-badge">
                <span>☕</span>
                <span>Premium Caffeine Tracking</span>
            </div>
            <h1 class="hero-title">Caffeine Half-Life Calculator</h1>
            <p class="hero-subtitle">Track your caffeine journey with scientific precision and get personalized sleep
                recommendations</p>
        </div>
    </section>

    <main class="container">
        <div class="calculator-layout">
            <!-- Input Panel -->
            <div class="calculator-panel">
                <h2 class="panel-title">
                    <span>📊</span>
                    Caffeine Input
                </h2>

                <!-- Drink Presets -->
                <div class="form-section">
                    <h3 class="section-title">
                        <span>☕</span>
                        Choose Your Drink
                    </h3>
                    <div class="preset-drinks">
                        <div class="drink-preset active" data-caffeine="95" data-name="Coffee">
                            <div class="drink-icon">☕</div>
                            <div class="drink-name">Coffee</div>
                            <div class="drink-caffeine">95mg</div>
                        </div>
                        <div class="drink-preset" data-caffeine="150" data-name="Espresso">
                            <div class="drink-icon">🍵</div>
                            <div class="drink-name">Espresso</div>
                            <div class="drink-caffeine">150mg</div>
                        </div>
                        <div class="drink-preset" data-caffeine="200" data-name="Energy Drink">
                            <div class="drink-icon">🥤</div>
                            <div class="drink-name">Energy Drink</div>
                            <div class="drink-caffeine">200mg</div>
                        </div>
                        <div class="drink-preset" data-caffeine="50" data-name="Tea">
                            <div class="drink-icon">🫖</div>
                            <div class="drink-name">Tea</div>
                            <div class="drink-caffeine">50mg</div>
                        </div>
                    </div>
                </div>

                <!-- Custom Amount -->
                <div class="form-section">
                    <div class="input-group">
                        <label for="caffeine-amount" class="input-label">Caffeine Amount (mg)</label>
                        <input type="number" id="caffeine-amount" class="input-field" min="0" max="1000" value="95"
                            step="5">
                        <div class="input-help">Standard coffee: 80-200mg, Energy drinks: 150-300mg</div>
                    </div>
                </div>

                <!-- Consumption Time -->
                <div class="form-section">
                    <div class="input-group">
                        <label for="consumption-time" class="input-label">When did you drink it?</label>
                        <input type="datetime-local" id="consumption-time" class="input-field">
                        <div class="input-help">Leave blank to use current time</div>
                    </div>
                </div>

                <!-- Metabolism Speed -->
                <div class="form-section">
                    <div class="input-group">
                        <label for="metabolism" class="input-label">Your Metabolism</label>
                        <select id="metabolism" class="input-field">
                            <option value="3">Fast Metabolism (3hr half-life)</option>
                            <option value="5" selected>Average Metabolism (5hr half-life)</option>
                            <option value="7">Slow Metabolism (7hr half-life)</options>
                            <option value="9">Very Slow Metabolism (9hr half-life)</option>
                        </select>
                        <div class="input-help">Age, genetics, and medications affect caffeine metabolism</div>
                    </div>
                </div>

                <!-- Sleep Goal -->
                <div class="form-section">
                    <div class="input-group">
                        <label for="sleep-goal" class="input-label">Desired Bedtime (Optional)</label>
                        <input type="time" id="sleep-goal" class="input-field" value="22:00">
                        <div class="input-help">We'll tell you if caffeine will affect your sleep</div>
                    </div>
                </div>

                <button class="btn-primary" onclick="calculateCaffeine()">
                    <span>⚡</span>
                    Calculate My Caffeine Levels
                </button>
            </div>

            <!-- Results Panel -->
            <div class="calculator-panel results-panel" id="results-panel">
                <h2 class="panel-title">
                    <span>📈</span>
                    Your Caffeine Journey
                    <span class="live-indicator">
                        <span class="live-dot"></span>
                        LIVE
                    </span>
                </h2>

                <!-- Live Status -->
                <div class="live-status">
                    <div class="status-header">
                        <div>
                            <div class="current-level" id="current-caffeine">0 mg</div>
                            <div style="font-size: 0.875rem; color: var(--coffee-medium);">Currently in your system
                            </div>
                        </div>
                        <div class="level-change" id="level-change">
                            <span>↓</span>
                            <span>Decreasing</span>
                        </div>
                    </div>
                </div>

                <!-- Chart -->
                <div class="timeline-container">
                    <div class="timeline-header">
                        <h3 class="timeline-title">Caffeine Decay Timeline</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="caffeineChart"></canvas>
                    </div>
                </div>

                <!-- Key Milestones -->
                <div class="milestones" id="milestones">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
        </div>
    </main>

    <!-- Enhanced Footer -->
    <!-- Newsletter Bar -->
    <div class="newsletter-bar" x-data="newsletterForm()">
        <div class="newsletter-container">
            <div class="newsletter-content">
                <div class="newsletter-info">
                    <h3>🎉 Join Our Calculator Community!</h3>
                    <p>Get updates on new fun calculators and practical tools</p>
                </div>
                <form class="newsletter-form" @submit.prevent="submitNewsletter()" x-show="!showSuccess">
                    <input type="email" class="newsletter-input" placeholder="Enter your email for calculator updates"
                        x-model="email" required>
                    <button type="submit" class="newsletter-submit" :disabled="isSubmitting">
                        <span x-show="isSubmitting" class="loading-spinner"></span>
                        <span x-text="isSubmitting ? 'Subscribing...' : '🚀 Subscribe'"></span>
                    </button>
                </form>
                <div x-show="showSuccess" class="newsletter-success">
                    <p style="color: var(--accent-light); font-weight: 600;">
                        ✅ Awesome! You'll get updates on the coolest new calculators!
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>🎮 About Docket.One</h4>
                    <p>Making life easier (and more fun) with calculators that actually matter. From figuring out if you
                        should buy a car or just Uber everywhere, to calculating your caffeine half-life, we've got the
                        tools for modern life.</p>
                    <p>Practical meets playful. Because adulting is hard enough.</p>
                </div>

                <div class="footer-section">
                    <h4>🎯 Calculator Categories</h4>
                    <ul class="footer-links">
                        <li><a href="https://docket.one/pages/BigKidMath/"><span class="calculator-emoji">🧠</span>
                                BigKidMath - Adult Life Tools</a></li>
                        <li><a href="https://docket.one/pages/CipherLab/"><span class="calculator-emoji">🔐</span>
                                CipherLab - Secret Codes & Security</a>
                        </li>
                        <li><a href="https://docket.one/pages/GeekGalaxy/"><span class="calculator-emoji">🚀</span>
                                GeekGalaxy - Sci-Fi & Fantasy Fun</a></li>
                        <li><a href="https://docket.one/pages/LifeHacks/"><span class="calculator-emoji">⚡</span>
                                LifeHacks - Productivity & Wellness</a></li>
                        <li><a href="https://docket.one/pages/Math_Magik/"><span class="calculator-emoji">🧙‍♀️</span>
                                Math Magik - Mathematical Wizardry</a>
                        </li>
                        <li><a href="https://docket.one/pages/Otaku_Ops/"><span class="calculator-emoji">🗾</span> Otaku
                                Ops - Anime & Culture</a></li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h4>💬 Support & Info</h4>
                    <ul class="footer-links">
                        <li><a href="pages/support/help.html"><span class="calculator-emoji">❓</span> Help &
                                FAQ</a></li>
                        <li><a href="pages/support/privacy.html"><span class="calculator-emoji">🔒</span> Privacy
                                Policy</a></li>
                        <li><a href="pages/support/terms.html"><span class="calculator-emoji">📋</span> Terms of
                                Service</a></li>
                        <li><a href="pages/support/accessibility.html"><span class="calculator-emoji">♿</span>
                                Accessibility</a></li>
                        <li><a href="pages/support/contact.html"><span class="calculator-emoji">📧</span> Contact
                                Us</a></li>
                    </ul>
                </div>
            </div>

            <div class="footer-bottom">
                <div class="footer-logo">🧮 Docket.One</div>
                <div class="footer-copyright">
                    © 2025 Docket.One. All rights reserved. Making calculations fun since... well, recently!
                </div>
                <div class="social-links">
                    <a href="#" class="social-link" aria-label="Twitter">𝕏</a>
                    <a href="#" class="social-link" aria-label="LinkedIn">💼</a>
                    <a href="#" class="social-link" aria-label="GitHub">🐙</a>
                    <a href="#" class="social-link" aria-label="Email">📧</a>
                </div>
            </div>
        </div>
    </footer>
    <script>
        // Global variables
        let caffeineChart = null;
        let updateInterval = null;
        let calculationData = null;
        
        // Initialize the calculator
        document.addEventListener('DOMContentLoaded', function() {
            initializeDrinkPresets();
            setCurrentTime();
            updateCurrentTime();
        });
        
        // Initialize drink presets
        function initializeDrinkPresets() {
            const presets = document.querySelectorAll('.drink-preset');
            presets.forEach(preset => {
                preset.addEventListener('click', function() {
                    // Remove active class from all presets
                    presets.forEach(p => p.classList.remove('active'));
                    
                    // Add active class to clicked preset
                    this.classList.add('active');
                    
                    // Update caffeine amount
                    const caffeine = this.dataset.caffeine;
                    document.getElementById('caffeine-amount').value = caffeine;
                });
            });
        }
        
        // Set current time as default
        function setCurrentTime() {
            const now = new Date();
            const localDateTime = new Date(now.getTime() - now.getTimezoneOffset() * 60000)
                .toISOString()
                .slice(0, 16);
            document.getElementById('consumption-time').value = localDateTime;
        }
        
        // Update current time display
        function updateCurrentTime() {
            const timeElement = document.getElementById('current-time');
            if (timeElement) {
                const now = new Date();
                timeElement.textContent = `Live Updates - ${now.toLocaleTimeString()}`;
            }
        }
        
        // Main calculation function
        function calculateCaffeine() {
            const caffeineAmount = parseFloat(document.getElementById('caffeine-amount').value);
            const consumptionTime = document.getElementById('consumption-time').value;
            const halfLife = parseFloat(document.getElementById('metabolism').value);
            const sleepGoal = document.getElementById('sleep-goal').value;
            
            if (!caffeineAmount || caffeineAmount <= 0) {
                alert('Please enter a valid caffeine amount');
                return;
            }
            
            // Use current time if consumption time is not provided
            const consumptionDate = consumptionTime ? 
                new Date(consumptionTime) : 
                new Date();
            
            // Store calculation data
            calculationData = {
                initialAmount: caffeineAmount,
                consumptionTime: consumptionDate,
                halfLife: halfLife,
                sleepGoal: sleepGoal
            };
            
            // Show results panel
            const resultsPanel = document.getElementById('results-panel');
            resultsPanel.classList.add('active');
            
            // Generate timeline data
            generateTimeline();
            
            // Create chart
            createCaffeineChart();
            
            // Generate milestones
            generateMilestones();
            
            // Start real-time updates
            startRealTimeUpdates();
            
            // Scroll to results
            resultsPanel.scrollIntoView({ behavior: 'smooth' });
        }
        
        // Generate timeline data
        function generateTimeline() {
            const hours = 24; // 24 hours timeline
            const timelineData = [];
            
            for (let i = 0; i <= hours; i++) {
                const time = new Date(calculationData.consumptionTime);
                time.setHours(time.getHours() + i);
                
                const caffeineLevel = calculateCaffeineAtTime(time);
                
                timelineData.push({
                    time: time,
                    hours: i,
                    caffeine: caffeineLevel,
                    label: i === 0 ? 'Consumption' : `${i}h`
                });
            }
            
            calculationData.timeline = timelineData;
        }
        
        // Calculate caffeine level at specific time
        function calculateCaffeineAtTime(targetTime) {
            const timeDiff = (targetTime - calculationData.consumptionTime) / (1000 * 60 * 60); // hours
            
            if (timeDiff < 0) return 0;
            
            // Caffeine half-life formula: C(t) = C0 * (1/2)^(t/t½)
            const halfLifeHours = calculationData.halfLife;
            const currentLevel = calculationData.initialAmount * Math.pow(0.5, timeDiff / halfLifeHours);
            
            return Math.max(0, currentLevel);
        }
        
        // Create Chart.js visualization
        function createCaffeineChart() {
            const ctx = document.getElementById('caffeineChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (caffeineChart) {
                caffeineChart.destroy();
            }
            
            const timeline = calculationData.timeline;
            const currentTime = new Date();
            
            caffeineChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: timeline.map(point => point.label),
                    datasets: [{
                        label: 'Caffeine Level (mg)',
                        data: timeline.map(point => point.caffeine),
                        borderColor: '#8b4513',
                        backgroundColor: 'rgba(139, 69, 19, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#8b4513',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                font: {
                                    family: 'Inter',
                                    size: 12
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Time (hours from consumption)',
                                font: {
                                    family: 'Inter',
                                    size: 12
                                }
                            },
                            grid: {
                                color: 'rgba(139, 69, 19, 0.1)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Caffeine (mg)',
                                font: {
                                    family: 'Inter',
                                    size: 12
                                }
                            },
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(139, 69, 19, 0.1)'
                            }
                        }
                    },
                    elements: {
                        point: {
                            hoverRadius: 8
                        }
                    }
                }
            });
        }
        
        // Generate milestone cards
        function generateMilestones() {
            const milestonesContainer = document.getElementById('milestones');
            const milestones = [
                {
                    percentage: 75,
                    label: '75% Remaining',
                    description: 'Still feeling the effects'
                },
                {
                    percentage: 50,
                    label: '50% Remaining',
                    description: 'Half-life reached'
                },
                {
                    percentage: 25,
                    label: '25% Remaining',
                    description: 'Effects diminishing'
                },
                {
                    percentage: 12.5,
                    label: '12.5% Remaining',
                    description: 'Minimal effects'
                },
                {
                    percentage: 6.25,
                    label: '6.25% Remaining',
                    description: 'Nearly eliminated'
                }
            ];
            
            let milestonesHTML = '';
            
            milestones.forEach(milestone => {
                const targetAmount = calculationData.initialAmount * (milestone.percentage / 100);
                const timeToReach = calculateTimeToReachLevel(targetAmount);
                
                milestonesHTML += `
                    <div class="milestone">
                        <div class="milestone-time">${formatTimeFromNow(timeToReach)}</div>
                        <div class="milestone-label">${milestone.label}</div>
                        <div class="milestone-desc">${milestone.description}</div>
                    </div>
                `;
            });
            
            milestonesContainer.innerHTML = milestonesHTML;
        }
        
        // Calculate time to reach specific caffeine level
        function calculateTimeToReachLevel(targetLevel) {
            if (targetLevel >= calculationData.initialAmount) {
                return calculationData.consumptionTime;
            }
            
            // Solve for t in: targetLevel = initialAmount * (1/2)^(t/halfLife)
            const ratio = targetLevel / calculationData.initialAmount;
            const timeHours = calculationData.halfLife * Math.log(ratio) / Math.log(0.5);
            
            const resultTime = new Date(calculationData.consumptionTime);
            resultTime.setHours(resultTime.getHours() + timeHours);
            
            return resultTime;
        }
        
        // Format time from now
        function formatTimeFromNow(targetTime) {
            const now = new Date();
            const timeDiff = targetTime - now;
            
            if (timeDiff <= 0) {
                return 'Now';
            }
            
            const hours = Math.floor(timeDiff / (1000 * 60 * 60));
            const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
            
            if (hours === 0) {
                return `${minutes}m`;
            } else if (minutes === 0) {
                return `${hours}h`;
            } else {
                return `${hours}h ${minutes}m`;
            }
        }
        
        
        // Start real-time updates
        function startRealTimeUpdates() {
            // Clear existing interval
            if (updateInterval) {
                clearInterval(updateInterval);
            }
            
            // Update every 30 seconds
            updateInterval = setInterval(() => {
                updateLiveStatus();
                updateCurrentTime();
            }, 30000);
            
            // Initial update
            updateLiveStatus();
        }
        
        // Update live status
        function updateLiveStatus() {
            const currentCaffeine = calculateCaffeineAtTime(new Date());
            const currentCaffeineElement = document.getElementById('current-caffeine');
            const levelChangeElement = document.getElementById('level-change');
            const sleepImpactElement = document.getElementById('sleep-impact');
            
            // Update current caffeine level
            currentCaffeineElement.textContent = `${currentCaffeine.toFixed(1)} mg`;
            
            // Update trend
            const oneMinuteAgo = new Date();
            oneMinuteAgo.setMinutes(oneMinuteAgo.getMinutes() - 1);
            const previousLevel = calculateCaffeineAtTime(oneMinuteAgo);
            
            if (currentCaffeine < previousLevel) {
                levelChangeElement.innerHTML = '<span>↓</span><span>Decreasing</span>';
                levelChangeElement.style.color = '#10b981';
            } else {
                levelChangeElement.innerHTML = '<span>→</span><span>Stable</span>';
                levelChangeElement.style.color = '#f59e0b';
            }
            
            // Update sleep impact
            const sleepGoal = calculationData.sleepGoal;
            if (sleepGoal) {
                const sleepTime = new Date();
                const [hours, minutes] = sleepGoal.split(':');
                sleepTime.setHours(parseInt(hours), parseInt(minutes), 0, 0);
                
                if (sleepTime <= new Date()) {
                    sleepTime.setDate(sleepTime.getDate() + 1);
                }
                
                const caffeineAtSleep = calculateCaffeineAtTime(sleepTime);
                
                if (caffeineAtSleep > 25) {
                    sleepImpactElement.innerHTML = `⚠️ ${caffeineAtSleep.toFixed(1)}mg at bedtime - may affect sleep`;
                    sleepImpactElement.className = 'sleep-impact';
                } else {
                    sleepImpactElement.innerHTML = `✅ ${caffeineAtSleep.toFixed(1)}mg at bedtime - sleep-friendly`;
                    sleepImpactElement.className = 'sleep-impact safe';
                }
            }
        }
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (updateInterval) {
                clearInterval(updateInterval);
            }
        });
        
        // Export functionality (bonus feature)
        function exportResults() {
            if (!calculationData) return;
            
            const data = {
                timestamp: new Date().toISOString(),
                initialCaffeine: calculationData.initialAmount,
                consumptionTime: calculationData.consumptionTime,
                halfLife: calculationData.halfLife,
                timeline: calculationData.timeline.map(point => ({
                    hours: point.hours,
                    caffeine: point.caffeine.toFixed(2)
                }))
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `caffeine-timeline-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // Share functionality (bonus feature)
        async function shareResults() {
            if (!calculationData) return;
            
            const currentCaffeine = calculateCaffeineAtTime(new Date());
            const shareText = `☕ My Caffeine Journey:\n\nStarted with ${calculationData.initialAmount}mg\nCurrently have ${currentCaffeine.toFixed(1)}mg in my system\n\nTrack your caffeine with precision!`;
            
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: 'My Caffeine Timeline',
                        text: shareText,
                        url: window.location.href
                    });
                } catch (err) {
                    console.log('Error sharing:', err);
                }
            } else {
                // Fallback to clipboard
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('Results copied to clipboard!');
                });
            }
        }
    </script>
	<script src="../../common/navbar-enhanced.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            new EnhancedNavbar();
        });
    </script>

</body>

</html>